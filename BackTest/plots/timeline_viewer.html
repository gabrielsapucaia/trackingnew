<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Linha do tempo — eventos</title>
    <style>
      :root {
        --lane-height: 34px;
        --lane-gap: 10px;
        --axis-height: 34px;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        margin: 18px;
        color: #111;
      }

      h1 {
        font-size: 18px;
        margin: 0 0 10px 0;
      }

      .toolbar {
        display: flex;
        flex-wrap: wrap;
        gap: 10px 14px;
        align-items: center;
        margin: 0 0 12px 0;
      }

      .toolbar label {
        font-size: 13px;
        color: #222;
      }

      .toolbar select, .toolbar input {
        font-size: 13px;
        padding: 6px 8px;
        border: 1px solid #D0D7DE;
        border-radius: 8px;
        background: white;
      }

      .toolbar button {
        font-size: 13px;
        padding: 6px 10px;
        border: 1px solid #D0D7DE;
        border-radius: 8px;
        background: #F6F8FA;
        cursor: pointer;
      }
      .toolbar button:hover { background: #EEF1F4; }

      .hint {
        font-size: 13px;
        color: #444;
        margin: 0 0 14px 0;
      }

      .legend {
        display: flex;
        flex-wrap: wrap;
        gap: 8px 14px;
        font-size: 12px;
        color: #222;
        margin: 0 0 10px 0;
      }
      .legend-item {
        display: inline-flex;
        gap: 8px;
        align-items: center;
      }
      .swatch {
        width: 22px;
        height: 12px;
        border: 1px solid #1113;
        border-radius: 3px;
        background-size: 12px 12px;
      }
      .swatch.load {
        background-image: repeating-linear-gradient(45deg, rgba(210,0,0,.55), rgba(210,0,0,.55) 2px, rgba(255,0,0,.10) 2px, rgba(255,0,0,.10) 8px);
      }
      .swatch.dump {
        background-image: repeating-linear-gradient(-45deg, rgba(0,128,0,.55), rgba(0,128,0,.55) 2px, rgba(0,255,0,.10) 2px, rgba(0,255,0,.10) 8px);
      }
      .swatch.wait {
        background-image: repeating-linear-gradient(0deg, rgba(179,143,0,.55), rgba(179,143,0,.55) 2px, rgba(255,212,0,.14) 2px, rgba(255,212,0,.14) 8px);
      }

      .timeline {
        border: 1px solid #E6E6E6;
        border-radius: 12px;
        overflow: hidden;
      }

      .scroll {
        overflow-x: auto;
        overflow-y: hidden;
        background: white;
      }

      .svg-wrap {
        position: relative;
        height: calc(var(--axis-height) + 2 * var(--lane-height) + var(--lane-gap) + 18px);
      }

      svg {
        display: block;
      }

      .topbar {
        display: flex;
        justify-content: space-between;
        gap: 12px;
        margin: 0 0 10px 0;
        font-size: 12px;
        color: #333;
      }
      .topbar code {
        background: #F6F8FA;
        padding: 2px 6px;
        border-radius: 6px;
      }

      .tooltip {
        position: fixed;
        z-index: 9999;
        pointer-events: none;
        display: none;
        max-width: 360px;
        background: rgba(20, 20, 20, 0.92);
        color: #fff;
        padding: 8px 10px;
        border-radius: 10px;
        font-size: 12px;
        line-height: 1.35;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
      }
      .tooltip .k {
        color: rgba(255,255,255,0.75);
      }
    </style>
  </head>
  <body>
    <h1>Linha do tempo dos eventos (rolagem horizontal)</h1>
    <div class="toolbar">
      <label>Janela visível:
        <select id="windowHours">
          <option value="0.25">15 min</option>
          <option value="0.5">30 min</option>
          <option value="1" selected>1 hora</option>
          <option value="2">2 horas</option>
          <option value="4">4 horas</option>
          <option value="6">6 horas</option>
          <option value="8">8 horas</option>
          <option value="10">10 horas</option>
          <option value="12">12 horas</option>
        </select>
      </label>
      <button id="backBtn" type="button">← Voltar 1 janela</button>
      <button id="fwdBtn" type="button">Avançar 1 janela →</button>
      <label>Ir para ciclo:
        <input id="gotoCycle" type="number" min="1" step="1" style="width: 90px" placeholder="ex: 7" />
      </label>
      <button id="gotoCycleBtn" type="button">Ir</button>
      <label style="display:inline-flex; gap: 8px; align-items:center;">
        <input id="toggleWait" type="checkbox" checked />
        mostrar aguardando
      </label>
    </div>
    <p class="hint">Dica: a janela visível é proporcional à largura da sua tela. Use trackpad/scroll horizontal para navegar. Passe o mouse sobre um bloco para ver detalhes.</p>

    <div class="legend">
      <span class="legend-item"><span class="swatch load"></span>carregamento</span>
      <span class="legend-item"><span class="swatch dump"></span>basculamento</span>
      <span class="legend-item"><span class="swatch wait"></span>aguardando</span>
    </div>

    <div class="topbar">
      <div>Arquivo de eventos: <code>events_detected.csv</code></div>
      <div id="visibleRange"></div>
    </div>

    <div class="timeline">
      <div class="scroll" id="scroll">
        <div class="svg-wrap">
          <svg id="svg" xmlns="http://www.w3.org/2000/svg"></svg>
        </div>
      </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <script>
      const EVENTS = [{"idx":1,"cycle_id":null,"kind":"basculamento","start_ms":1765549135000,"end_ms":1765549165000,"duration_sec":31,"lat":-11.694031,"lon":-47.166309,"cluster_key":"-11.694,-47.166"},{"idx":2,"cycle_id":null,"kind":"basculamento","start_ms":1765549190000,"end_ms":1765549203000,"duration_sec":14,"lat":-11.694138,"lon":-47.166175,"cluster_key":"-11.694,-47.166"},{"idx":3,"cycle_id":null,"kind":"espera_basculamento","start_ms":1765549332000,"end_ms":1765549482000,"duration_sec":151,"lat":-11.694127,"lon":-47.166172,"cluster_key":"-11.694,-47.166"},{"idx":4,"cycle_id":1,"kind":"carregamento","start_ms":1765550052000,"end_ms":1765550191000,"duration_sec":140,"lat":-11.697981,"lon":-47.155153,"cluster_key":"-11.698,-47.155"},{"idx":5,"cycle_id":1,"kind":"basculamento","start_ms":1765551227000,"end_ms":1765551290000,"duration_sec":64,"lat":-11.693838,"lon":-47.165716,"cluster_key":"-11.694,-47.166"},{"idx":6,"cycle_id":null,"kind":"espera_carregamento","start_ms":1765555374000,"end_ms":1765555690000,"duration_sec":317,"lat":-11.698725,"lon":-47.155164,"cluster_key":"-11.699,-47.155"},{"idx":7,"cycle_id":2,"kind":"espera_carregamento","start_ms":1765555809000,"end_ms":1765555899000,"duration_sec":91,"lat":-11.698093,"lon":-47.154981,"cluster_key":"-11.698,-47.155"},{"idx":8,"cycle_id":2,"kind":"espera_carregamento","start_ms":1765555939000,"end_ms":1765555975000,"duration_sec":37,"lat":-11.698011,"lon":-47.154951,"cluster_key":"-11.698,-47.155"},{"idx":9,"cycle_id":2,"kind":"carregamento","start_ms":1765555991000,"end_ms":1765556287000,"duration_sec":297,"lat":-11.698043,"lon":-47.155153,"cluster_key":"-11.698,-47.155"},{"idx":10,"cycle_id":null,"kind":"espera_basculamento","start_ms":1765557333000,"end_ms":1765557387000,"duration_sec":55,"lat":-11.693874,"lon":-47.165829,"cluster_key":"-11.694,-47.166"},{"idx":11,"cycle_id":null,"kind":"espera_basculamento","start_ms":1765557422000,"end_ms":1765557450000,"duration_sec":29,"lat":-11.693824,"lon":-47.165738,"cluster_key":"-11.694,-47.166"},{"idx":12,"cycle_id":3,"kind":"espera_carregamento","start_ms":1765558085000,"end_ms":1765558151000,"duration_sec":67,"lat":-11.697981,"lon":-47.15519,"cluster_key":"-11.698,-47.155"},{"idx":13,"cycle_id":3,"kind":"carregamento","start_ms":1765558153000,"end_ms":1765558308000,"duration_sec":156,"lat":-11.698018,"lon":-47.155192,"cluster_key":"-11.698,-47.155"},{"idx":14,"cycle_id":3,"kind":"basculamento","start_ms":1765559301000,"end_ms":1765559310000,"duration_sec":10,"lat":-11.694052,"lon":-47.165378,"cluster_key":"-11.694,-47.165"},{"idx":15,"cycle_id":3,"kind":"espera_basculamento","start_ms":1765559330000,"end_ms":1765559392000,"duration_sec":63,"lat":-11.69415,"lon":-47.165527,"cluster_key":"-11.694,-47.166"},{"idx":16,"cycle_id":3,"kind":"basculamento","start_ms":1765559409000,"end_ms":1765559435000,"duration_sec":27,"lat":-11.694109,"lon":-47.165504,"cluster_key":"-11.694,-47.166"},{"idx":17,"cycle_id":null,"kind":"espera_carregamento","start_ms":1765560267000,"end_ms":1765560613000,"duration_sec":347,"lat":-11.699739,"lon":-47.157369,"cluster_key":"-11.700,-47.157"},{"idx":18,"cycle_id":4,"kind":"carregamento","start_ms":1765560673000,"end_ms":1765561119000,"duration_sec":407,"lat":-11.699316,"lon":-47.157626,"cluster_key":"-11.699,-47.158"},{"idx":19,"cycle_id":4,"kind":"espera_carregamento","start_ms":1765560877000,"end_ms":1765561119000,"duration_sec":243,"lat":-11.699153,"lon":-47.157569,"cluster_key":"-11.699,-47.158"},{"idx":20,"cycle_id":null,"kind":"espera_basculamento","start_ms":1765561782000,"end_ms":1765561828000,"duration_sec":47,"lat":-11.692388,"lon":-47.164855,"cluster_key":"-11.692,-47.165"},{"idx":21,"cycle_id":null,"kind":"espera_carregamento","start_ms":1765562223000,"end_ms":1765562237000,"duration_sec":15,"lat":-11.699268,"lon":-47.157556,"cluster_key":"-11.699,-47.158"},{"idx":22,"cycle_id":null,"kind":"carregamento","start_ms":1765562249000,"end_ms":1765562462000,"duration_sec":214,"lat":-11.699181,"lon":-47.157536,"cluster_key":"-11.699,-47.158"},{"idx":23,"cycle_id":null,"kind":"espera_basculamento","start_ms":1765563129000,"end_ms":1765563190000,"duration_sec":62,"lat":-11.692663,"lon":-47.16407,"cluster_key":"-11.693,-47.164"},{"idx":24,"cycle_id":5,"kind":"carregamento","start_ms":1765563568000,"end_ms":1765563817000,"duration_sec":249,"lat":-11.699077,"lon":-47.157274,"cluster_key":"-11.699,-47.157"},{"idx":25,"cycle_id":5,"kind":"espera_carregamento","start_ms":1765563677000,"end_ms":1765563817000,"duration_sec":141,"lat":-11.699057,"lon":-47.157287,"cluster_key":"-11.699,-47.157"},{"idx":26,"cycle_id":5,"kind":"espera_basculamento","start_ms":1765564499000,"end_ms":1765564553000,"duration_sec":55,"lat":-11.692571,"lon":-47.164776,"cluster_key":"-11.693,-47.165"},{"idx":27,"cycle_id":5,"kind":"basculamento","start_ms":1765564565000,"end_ms":1765564583000,"duration_sec":19,"lat":-11.692621,"lon":-47.164842,"cluster_key":"-11.693,-47.165"},{"idx":28,"cycle_id":6,"kind":"carregamento","start_ms":1765564911000,"end_ms":1765564993000,"duration_sec":83,"lat":-11.699038,"lon":-47.157277,"cluster_key":"-11.699,-47.157"},{"idx":29,"cycle_id":6,"kind":"espera_carregamento","start_ms":1765565004000,"end_ms":1765565044000,"duration_sec":41,"lat":-11.699035,"lon":-47.157277,"cluster_key":"-11.699,-47.157"},{"idx":30,"cycle_id":null,"kind":"espera_basculamento","start_ms":1765565763000,"end_ms":1765565818000,"duration_sec":56,"lat":-11.692599,"lon":-47.164779,"cluster_key":"-11.693,-47.165"},{"idx":31,"cycle_id":null,"kind":"carregamento","start_ms":1765566202000,"end_ms":1765566328000,"duration_sec":127,"lat":-11.699045,"lon":-47.157301,"cluster_key":"-11.699,-47.157"},{"idx":32,"cycle_id":null,"kind":"espera_basculamento","start_ms":1765566983000,"end_ms":1765567023000,"duration_sec":41,"lat":-11.69266,"lon":-47.165403,"cluster_key":"-11.693,-47.165"},{"idx":33,"cycle_id":null,"kind":"espera_basculamento","start_ms":1765567033000,"end_ms":1765567057000,"duration_sec":25,"lat":-11.692669,"lon":-47.165364,"cluster_key":"-11.693,-47.165"},{"idx":34,"cycle_id":null,"kind":"carregamento","start_ms":1765567411000,"end_ms":1765567527000,"duration_sec":117,"lat":-11.698995,"lon":-47.157245,"cluster_key":"-11.699,-47.157"},{"idx":35,"cycle_id":null,"kind":"espera_basculamento","start_ms":1765568171000,"end_ms":1765568216000,"duration_sec":46,"lat":-11.692794,"lon":-47.16435,"cluster_key":"-11.693,-47.164"},{"idx":36,"cycle_id":null,"kind":"carregamento","start_ms":1765568559000,"end_ms":1765568705000,"duration_sec":147,"lat":-11.699025,"lon":-47.157313,"cluster_key":"-11.699,-47.157"},{"idx":37,"cycle_id":null,"kind":"espera_basculamento","start_ms":1765569394000,"end_ms":1765569435000,"duration_sec":42,"lat":-11.692837,"lon":-47.164457,"cluster_key":"-11.693,-47.164"},{"idx":38,"cycle_id":7,"kind":"carregamento","start_ms":1765569781000,"end_ms":1765569924000,"duration_sec":144,"lat":-11.69903,"lon":-47.157321,"cluster_key":"-11.699,-47.157"},{"idx":39,"cycle_id":7,"kind":"basculamento","start_ms":1765570563000,"end_ms":1765570600000,"duration_sec":38,"lat":-11.692511,"lon":-47.165118,"cluster_key":"-11.693,-47.165"},{"idx":40,"cycle_id":7,"kind":"espera_basculamento","start_ms":1765570608000,"end_ms":1765570628000,"duration_sec":21,"lat":-11.692574,"lon":-47.165112,"cluster_key":"-11.693,-47.165"},{"idx":41,"cycle_id":8,"kind":"carregamento","start_ms":1765570946000,"end_ms":1765571079000,"duration_sec":134,"lat":-11.699023,"lon":-47.157368,"cluster_key":"-11.699,-47.157"},{"idx":42,"cycle_id":8,"kind":"basculamento","start_ms":1765571716000,"end_ms":1765571762000,"duration_sec":47,"lat":-11.692506,"lon":-47.16499,"cluster_key":"-11.693,-47.165"},{"idx":43,"cycle_id":9,"kind":"carregamento","start_ms":1765572113000,"end_ms":1765572269000,"duration_sec":157,"lat":-11.699023,"lon":-47.157377,"cluster_key":"-11.699,-47.157"},{"idx":44,"cycle_id":null,"kind":"espera_basculamento","start_ms":1765572920000,"end_ms":1765572955000,"duration_sec":36,"lat":-11.692605,"lon":-47.164912,"cluster_key":"-11.693,-47.165"},{"idx":45,"cycle_id":null,"kind":"carregamento","start_ms":1765573352000,"end_ms":1765573507000,"duration_sec":156,"lat":-11.699022,"lon":-47.157374,"cluster_key":"-11.699,-47.157"},{"idx":46,"cycle_id":null,"kind":"espera_basculamento","start_ms":1765574157000,"end_ms":1765574220000,"duration_sec":64,"lat":-11.692675,"lon":-47.164978,"cluster_key":"-11.693,-47.165"},{"idx":47,"cycle_id":10,"kind":"espera_carregamento","start_ms":1765575533000,"end_ms":1765575596000,"duration_sec":64,"lat":-11.699119,"lon":-47.157199,"cluster_key":"-11.699,-47.157"},{"idx":48,"cycle_id":10,"kind":"carregamento","start_ms":1765575616000,"end_ms":1765575792000,"duration_sec":177,"lat":-11.699031,"lon":-47.157352,"cluster_key":"-11.699,-47.157"},{"idx":49,"cycle_id":10,"kind":"basculamento","start_ms":1765576421000,"end_ms":1765576440000,"duration_sec":20,"lat":-11.692611,"lon":-47.165187,"cluster_key":"-11.693,-47.165"},{"idx":50,"cycle_id":10,"kind":"basculamento","start_ms":1765576443000,"end_ms":1765576489000,"duration_sec":47,"lat":-11.692616,"lon":-47.165186,"cluster_key":"-11.693,-47.165"},{"idx":51,"cycle_id":11,"kind":"espera_carregamento","start_ms":1765578680000,"end_ms":1765578718000,"duration_sec":39,"lat":-11.699071,"lon":-47.157223,"cluster_key":"-11.699,-47.157"},{"idx":52,"cycle_id":11,"kind":"carregamento","start_ms":1765578753000,"end_ms":1765578921000,"duration_sec":169,"lat":-11.699027,"lon":-47.157382,"cluster_key":"-11.699,-47.157"},{"idx":53,"cycle_id":11,"kind":"basculamento","start_ms":1765579528000,"end_ms":1765579537000,"duration_sec":10,"lat":-11.692704,"lon":-47.16519,"cluster_key":"-11.693,-47.165"},{"idx":54,"cycle_id":11,"kind":"espera_basculamento","start_ms":1765579571000,"end_ms":1765579604000,"duration_sec":34,"lat":-11.69269,"lon":-47.165344,"cluster_key":"-11.693,-47.165"},{"idx":55,"cycle_id":11,"kind":"espera_basculamento","start_ms":1765579619000,"end_ms":1765579639000,"duration_sec":21,"lat":-11.692716,"lon":-47.165282,"cluster_key":"-11.693,-47.165"},{"idx":56,"cycle_id":12,"kind":"carregamento","start_ms":1765579984000,"end_ms":1765580100000,"duration_sec":117,"lat":-11.699014,"lon":-47.157425,"cluster_key":"-11.699,-47.157"},{"idx":57,"cycle_id":12,"kind":"espera_basculamento","start_ms":1765580666000,"end_ms":1765580708000,"duration_sec":43,"lat":-11.692797,"lon":-47.165388,"cluster_key":"-11.693,-47.165"},{"idx":58,"cycle_id":12,"kind":"espera_basculamento","start_ms":1765580722000,"end_ms":1765580738000,"duration_sec":17,"lat":-11.692759,"lon":-47.165341,"cluster_key":"-11.693,-47.165"},{"idx":59,"cycle_id":12,"kind":"basculamento","start_ms":1765580760000,"end_ms":1765580770000,"duration_sec":11,"lat":-11.692774,"lon":-47.165146,"cluster_key":"-11.693,-47.165"},{"idx":60,"cycle_id":13,"kind":"carregamento","start_ms":1765581108000,"end_ms":1765581261000,"duration_sec":154,"lat":-11.699067,"lon":-47.157442,"cluster_key":"-11.699,-47.157"},{"idx":61,"cycle_id":13,"kind":"basculamento","start_ms":1765581907000,"end_ms":1765581939000,"duration_sec":33,"lat":-11.692777,"lon":-47.165388,"cluster_key":"-11.693,-47.165"},{"idx":62,"cycle_id":13,"kind":"basculamento","start_ms":1765581950000,"end_ms":1765581965000,"duration_sec":16,"lat":-11.692779,"lon":-47.165344,"cluster_key":"-11.693,-47.165"},{"idx":63,"cycle_id":14,"kind":"carregamento","start_ms":1765582332000,"end_ms":1765582530000,"duration_sec":199,"lat":-11.699055,"lon":-47.157445,"cluster_key":"-11.699,-47.157"},{"idx":64,"cycle_id":14,"kind":"espera_basculamento","start_ms":1765583129000,"end_ms":1765583168000,"duration_sec":40,"lat":-11.692874,"lon":-47.165427,"cluster_key":"-11.693,-47.165"},{"idx":65,"cycle_id":14,"kind":"basculamento","start_ms":1765583174000,"end_ms":1765583188000,"duration_sec":15,"lat":-11.692833,"lon":-47.16539,"cluster_key":"-11.693,-47.165"},{"idx":66,"cycle_id":15,"kind":"carregamento","start_ms":1765583568000,"end_ms":1765583871000,"duration_sec":278,"lat":-11.698985,"lon":-47.157301,"cluster_key":"-11.699,-47.157"},{"idx":67,"cycle_id":15,"kind":"espera_carregamento","start_ms":1765583707000,"end_ms":1765583871000,"duration_sec":165,"lat":-11.698979,"lon":-47.157356,"cluster_key":"-11.699,-47.157"},{"idx":68,"cycle_id":15,"kind":"basculamento","start_ms":1765584518000,"end_ms":1765584565000,"duration_sec":48,"lat":-11.692735,"lon":-47.16504,"cluster_key":"-11.693,-47.165"},{"idx":69,"cycle_id":15,"kind":"basculamento","start_ms":1765584572000,"end_ms":1765584588000,"duration_sec":17,"lat":-11.692758,"lon":-47.165076,"cluster_key":"-11.693,-47.165"},{"idx":70,"cycle_id":16,"kind":"espera_carregamento","start_ms":1765584987000,"end_ms":1765585138000,"duration_sec":152,"lat":-11.69903,"lon":-47.157177,"cluster_key":"-11.699,-47.157"},{"idx":71,"cycle_id":16,"kind":"carregamento","start_ms":1765585179000,"end_ms":1765585372000,"duration_sec":194,"lat":-11.698929,"lon":-47.15738,"cluster_key":"-11.699,-47.157"},{"idx":72,"cycle_id":16,"kind":"basculamento","start_ms":1765586110000,"end_ms":1765586159000,"duration_sec":50,"lat":-11.692766,"lon":-47.164591,"cluster_key":"-11.693,-47.165"},{"idx":73,"cycle_id":16,"kind":"basculamento","start_ms":1765586163000,"end_ms":1765586181000,"duration_sec":19,"lat":-11.692791,"lon":-47.164561,"cluster_key":"-11.693,-47.165"},{"idx":74,"cycle_id":17,"kind":"espera_carregamento","start_ms":1765586867000,"end_ms":1765586913000,"duration_sec":47,"lat":-11.699143,"lon":-47.157187,"cluster_key":"-11.699,-47.157"},{"idx":75,"cycle_id":17,"kind":"carregamento","start_ms":1765586942000,"end_ms":1765587134000,"duration_sec":193,"lat":-11.698985,"lon":-47.157285,"cluster_key":"-11.699,-47.157"},{"idx":76,"cycle_id":17,"kind":"espera_basculamento","start_ms":1765587796000,"end_ms":1765587848000,"duration_sec":53,"lat":-11.692607,"lon":-47.164302,"cluster_key":"-11.693,-47.164"},{"idx":77,"cycle_id":17,"kind":"basculamento","start_ms":1765587917000,"end_ms":1765587966000,"duration_sec":50,"lat":-11.692162,"lon":-47.164277,"cluster_key":"-11.692,-47.164"},{"idx":78,"cycle_id":17,"kind":"espera_basculamento","start_ms":1765587998000,"end_ms":1765588154000,"duration_sec":157,"lat":-11.692077,"lon":-47.164234,"cluster_key":"-11.692,-47.164"},{"idx":79,"cycle_id":18,"kind":"espera_carregamento","start_ms":1765588517000,"end_ms":1765588563000,"duration_sec":47,"lat":-11.699118,"lon":-47.157208,"cluster_key":"-11.699,-47.157"},{"idx":80,"cycle_id":18,"kind":"carregamento","start_ms":1765588610000,"end_ms":1765588797000,"duration_sec":188,"lat":-11.699055,"lon":-47.1574,"cluster_key":"-11.699,-47.157"},{"idx":81,"cycle_id":18,"kind":"basculamento","start_ms":1765589427000,"end_ms":1765589463000,"duration_sec":37,"lat":-11.692777,"lon":-47.165123,"cluster_key":"-11.693,-47.165"},{"idx":82,"cycle_id":18,"kind":"basculamento","start_ms":1765589470000,"end_ms":1765589482000,"duration_sec":13,"lat":-11.692797,"lon":-47.165159,"cluster_key":"-11.693,-47.165"},{"idx":83,"cycle_id":19,"kind":"espera_carregamento","start_ms":1765589803000,"end_ms":1765589889000,"duration_sec":87,"lat":-11.699014,"lon":-47.157398,"cluster_key":"-11.699,-47.157"},{"idx":84,"cycle_id":19,"kind":"carregamento","start_ms":1765589930000,"end_ms":1765590105000,"duration_sec":176,"lat":-11.699099,"lon":-47.157502,"cluster_key":"-11.699,-47.158"},{"idx":85,"cycle_id":null,"kind":"espera_basculamento","start_ms":1765590737000,"end_ms":1765590774000,"duration_sec":38,"lat":-11.692708,"lon":-47.165101,"cluster_key":"-11.693,-47.165"},{"idx":86,"cycle_id":null,"kind":"espera_basculamento","start_ms":1765590787000,"end_ms":1765595472000,"duration_sec":4686,"lat":-11.692751,"lon":-47.165135,"cluster_key":"-11.693,-47.165"},{"idx":87,"cycle_id":null,"kind":"carregamento","start_ms":1765595931000,"end_ms":1765596086000,"duration_sec":156,"lat":-11.698992,"lon":-47.157455,"cluster_key":"-11.699,-47.157"},{"idx":88,"cycle_id":null,"kind":"espera_basculamento","start_ms":1765596717000,"end_ms":1765596756000,"duration_sec":40,"lat":-11.69281,"lon":-47.165164,"cluster_key":"-11.693,-47.165"},{"idx":89,"cycle_id":null,"kind":"espera_carregamento","start_ms":1765597156000,"end_ms":1765597424000,"duration_sec":269,"lat":-11.699205,"lon":-47.157561,"cluster_key":"-11.699,-47.158"},{"idx":90,"cycle_id":null,"kind":"espera_carregamento","start_ms":1765597450000,"end_ms":1765597497000,"duration_sec":48,"lat":-11.69912,"lon":-47.157459,"cluster_key":"-11.699,-47.157"},{"idx":91,"cycle_id":null,"kind":"carregamento","start_ms":1765597500000,"end_ms":1765597712000,"duration_sec":213,"lat":-11.699105,"lon":-47.157464,"cluster_key":"-11.699,-47.157"},{"idx":92,"cycle_id":null,"kind":"espera_basculamento","start_ms":1765598365000,"end_ms":1765598403000,"duration_sec":39,"lat":-11.692778,"lon":-47.165236,"cluster_key":"-11.693,-47.165"},{"idx":93,"cycle_id":null,"kind":"espera_basculamento","start_ms":1765598415000,"end_ms":1765598430000,"duration_sec":16,"lat":-11.692846,"lon":-47.165221,"cluster_key":"-11.693,-47.165"},{"idx":94,"cycle_id":null,"kind":"espera_basculamento","start_ms":1765598490000,"end_ms":1765598625000,"duration_sec":136,"lat":-11.693517,"lon":-47.16425,"cluster_key":"-11.694,-47.164"},{"idx":95,"cycle_id":null,"kind":"espera_basculamento","start_ms":1765598645000,"end_ms":1765598873000,"duration_sec":229,"lat":-11.693583,"lon":-47.164309,"cluster_key":"-11.694,-47.164"},{"idx":96,"cycle_id":20,"kind":"carregamento","start_ms":1765599214000,"end_ms":1765599742000,"duration_sec":307,"lat":-11.699127,"lon":-47.15747,"cluster_key":"-11.699,-47.157"},{"idx":97,"cycle_id":20,"kind":"espera_carregamento","start_ms":1765599338000,"end_ms":1765599372000,"duration_sec":35,"lat":-11.699039,"lon":-47.157389,"cluster_key":"-11.699,-47.157"},{"idx":98,"cycle_id":20,"kind":"espera_carregamento","start_ms":1765599396000,"end_ms":1765599424000,"duration_sec":29,"lat":-11.699194,"lon":-47.157489,"cluster_key":"-11.699,-47.157"},{"idx":99,"cycle_id":20,"kind":"espera_carregamento","start_ms":1765599440000,"end_ms":1765599492000,"duration_sec":53,"lat":-11.699317,"lon":-47.157496,"cluster_key":"-11.699,-47.157"},{"idx":100,"cycle_id":null,"kind":"espera_carregamento","start_ms":1765599542000,"end_ms":1765599743000,"duration_sec":202,"lat":-11.699141,"lon":-47.157577,"cluster_key":"-11.699,-47.158"},{"idx":101,"cycle_id":20,"kind":"basculamento","start_ms":1765600394000,"end_ms":1765600430000,"duration_sec":37,"lat":-11.692857,"lon":-47.165194,"cluster_key":"-11.693,-47.165"},{"idx":102,"cycle_id":null,"kind":"espera_carregamento","start_ms":1765600771000,"end_ms":1765601118000,"duration_sec":348,"lat":-11.699025,"lon":-47.157411,"cluster_key":"-11.699,-47.157"},{"idx":103,"cycle_id":21,"kind":"carregamento","start_ms":1765601174000,"end_ms":1765601407000,"duration_sec":234,"lat":-11.699196,"lon":-47.157579,"cluster_key":"-11.699,-47.158"},{"idx":104,"cycle_id":21,"kind":"basculamento","start_ms":1765602057000,"end_ms":1765602086000,"duration_sec":30,"lat":-11.692869,"lon":-47.165211,"cluster_key":"-11.693,-47.165"},{"idx":105,"cycle_id":21,"kind":"basculamento","start_ms":1765602103000,"end_ms":1765602112000,"duration_sec":10,"lat":-11.692938,"lon":-47.165231,"cluster_key":"-11.693,-47.165"},{"idx":106,"cycle_id":22,"kind":"carregamento","start_ms":1765602498000,"end_ms":1765602870000,"duration_sec":311,"lat":-11.699083,"lon":-47.157521,"cluster_key":"-11.699,-47.158"},{"idx":107,"cycle_id":22,"kind":"espera_carregamento","start_ms":1765602649000,"end_ms":1765602665000,"duration_sec":17,"lat":-11.699225,"lon":-47.157554,"cluster_key":"-11.699,-47.158"},{"idx":108,"cycle_id":22,"kind":"espera_carregamento","start_ms":1765602683000,"end_ms":1765602870000,"duration_sec":188,"lat":-11.699123,"lon":-47.157575,"cluster_key":"-11.699,-47.158"},{"idx":109,"cycle_id":null,"kind":"espera_basculamento","start_ms":1765603487000,"end_ms":1765603529000,"duration_sec":43,"lat":-11.692919,"lon":-47.165221,"cluster_key":"-11.693,-47.165"},{"idx":110,"cycle_id":null,"kind":"espera_basculamento","start_ms":1765603542000,"end_ms":1765603558000,"duration_sec":17,"lat":-11.693,"lon":-47.165252,"cluster_key":"-11.693,-47.165"},{"idx":111,"cycle_id":23,"kind":"carregamento","start_ms":1765603926000,"end_ms":1765604175000,"duration_sec":250,"lat":-11.699201,"lon":-47.157564,"cluster_key":"-11.699,-47.158"},{"idx":112,"cycle_id":23,"kind":"basculamento","start_ms":1765604813000,"end_ms":1765604861000,"duration_sec":49,"lat":-11.69294,"lon":-47.165255,"cluster_key":"-11.693,-47.165"},{"idx":113,"cycle_id":23,"kind":"basculamento","start_ms":1765604873000,"end_ms":1765604890000,"duration_sec":18,"lat":-11.692986,"lon":-47.165252,"cluster_key":"-11.693,-47.165"},{"idx":114,"cycle_id":24,"kind":"carregamento","start_ms":1765605213000,"end_ms":1765605541000,"duration_sec":285,"lat":-11.699108,"lon":-47.157567,"cluster_key":"-11.699,-47.158"},{"idx":115,"cycle_id":24,"kind":"espera_carregamento","start_ms":1765605358000,"end_ms":1765605541000,"duration_sec":184,"lat":-11.699047,"lon":-47.157571,"cluster_key":"-11.699,-47.158"},{"idx":116,"cycle_id":24,"kind":"basculamento","start_ms":1765606155000,"end_ms":1765606195000,"duration_sec":41,"lat":-11.692929,"lon":-47.165274,"cluster_key":"-11.693,-47.165"},{"idx":117,"cycle_id":24,"kind":"espera_basculamento","start_ms":1765606207000,"end_ms":1765606224000,"duration_sec":18,"lat":-11.692989,"lon":-47.165238,"cluster_key":"-11.693,-47.165"},{"idx":118,"cycle_id":25,"kind":"espera_carregamento","start_ms":1765606610000,"end_ms":1765606668000,"duration_sec":59,"lat":-11.699004,"lon":-47.157393,"cluster_key":"-11.699,-47.157"},{"idx":119,"cycle_id":25,"kind":"espera_carregamento","start_ms":1765606671000,"end_ms":1765606701000,"duration_sec":31,"lat":-11.699016,"lon":-47.15741,"cluster_key":"-11.699,-47.157"},{"idx":120,"cycle_id":25,"kind":"carregamento","start_ms":1765606710000,"end_ms":1765606858000,"duration_sec":149,"lat":-11.699032,"lon":-47.157515,"cluster_key":"-11.699,-47.158"},{"idx":121,"cycle_id":null,"kind":"espera_basculamento","start_ms":1765607433000,"end_ms":1765608453000,"duration_sec":1021,"lat":-11.694533,"lon":-47.165957,"cluster_key":"-11.695,-47.166"},{"idx":122,"cycle_id":25,"kind":"espera_basculamento","start_ms":1765608556000,"end_ms":1765608603000,"duration_sec":48,"lat":-11.692923,"lon":-47.165212,"cluster_key":"-11.693,-47.165"},{"idx":123,"cycle_id":25,"kind":"basculamento","start_ms":1765608616000,"end_ms":1765608632000,"duration_sec":17,"lat":-11.692979,"lon":-47.165171,"cluster_key":"-11.693,-47.165"},{"idx":124,"cycle_id":26,"kind":"espera_carregamento","start_ms":1765608917000,"end_ms":1765609102000,"duration_sec":186,"lat":-11.699211,"lon":-47.157563,"cluster_key":"-11.699,-47.158"},{"idx":125,"cycle_id":26,"kind":"carregamento","start_ms":1765609156000,"end_ms":1765609302000,"duration_sec":147,"lat":-11.699051,"lon":-47.157661,"cluster_key":"-11.699,-47.158"},{"idx":126,"cycle_id":26,"kind":"basculamento","start_ms":1765609934000,"end_ms":1765609971000,"duration_sec":38,"lat":-11.693037,"lon":-47.1653,"cluster_key":"-11.693,-47.165"},{"idx":127,"cycle_id":26,"kind":"espera_basculamento","start_ms":1765609986000,"end_ms":1765610002000,"duration_sec":17,"lat":-11.693086,"lon":-47.165261,"cluster_key":"-11.693,-47.165"},{"idx":128,"cycle_id":27,"kind":"espera_carregamento","start_ms":1765610318000,"end_ms":1765610419000,"duration_sec":102,"lat":-11.69929,"lon":-47.157385,"cluster_key":"-11.699,-47.157"},{"idx":129,"cycle_id":27,"kind":"carregamento","start_ms":1765610466000,"end_ms":1765610822000,"duration_sec":301,"lat":-11.698989,"lon":-47.157561,"cluster_key":"-11.699,-47.158"},{"idx":130,"cycle_id":27,"kind":"espera_carregamento","start_ms":1765610667000,"end_ms":1765610822000,"duration_sec":156,"lat":-11.699055,"lon":-47.157676,"cluster_key":"-11.699,-47.158"},{"idx":131,"cycle_id":27,"kind":"basculamento","start_ms":1765611420000,"end_ms":1765611464000,"duration_sec":45,"lat":-11.692997,"lon":-47.165249,"cluster_key":"-11.693,-47.165"},{"idx":132,"cycle_id":27,"kind":"basculamento","start_ms":1765611476000,"end_ms":1765611493000,"duration_sec":18,"lat":-11.693032,"lon":-47.165221,"cluster_key":"-11.693,-47.165"},{"idx":133,"cycle_id":28,"kind":"espera_carregamento","start_ms":1765611909000,"end_ms":1765612057000,"duration_sec":149,"lat":-11.699076,"lon":-47.157217,"cluster_key":"-11.699,-47.157"},{"idx":134,"cycle_id":28,"kind":"carregamento","start_ms":1765612091000,"end_ms":1765612216000,"duration_sec":126,"lat":-11.698917,"lon":-47.157211,"cluster_key":"-11.699,-47.157"},{"idx":135,"cycle_id":null,"kind":"espera_basculamento","start_ms":1765612797000,"end_ms":1765612842000,"duration_sec":46,"lat":-11.692998,"lon":-47.165186,"cluster_key":"-11.693,-47.165"},{"idx":136,"cycle_id":null,"kind":"espera_basculamento","start_ms":1765612858000,"end_ms":1765613081000,"duration_sec":224,"lat":-11.693031,"lon":-47.165149,"cluster_key":"-11.693,-47.165"},{"idx":137,"cycle_id":null,"kind":"espera_carregamento","start_ms":1765613364000,"end_ms":1765613608000,"duration_sec":245,"lat":-11.699081,"lon":-47.157536,"cluster_key":"-11.699,-47.158"},{"idx":138,"cycle_id":29,"kind":"espera_carregamento","start_ms":1765613686000,"end_ms":1765613736000,"duration_sec":51,"lat":-11.698981,"lon":-47.157267,"cluster_key":"-11.699,-47.157"},{"idx":139,"cycle_id":29,"kind":"carregamento","start_ms":1765613746000,"end_ms":1765613876000,"duration_sec":131,"lat":-11.698908,"lon":-47.157252,"cluster_key":"-11.699,-47.157"},{"idx":140,"cycle_id":29,"kind":"basculamento","start_ms":1765614414000,"end_ms":1765614459000,"duration_sec":46,"lat":-11.693013,"lon":-47.165248,"cluster_key":"-11.693,-47.165"},{"idx":141,"cycle_id":30,"kind":"carregamento","start_ms":1765614814000,"end_ms":1765615085000,"duration_sec":249,"lat":-11.69901,"lon":-47.157185,"cluster_key":"-11.699,-47.157"},{"idx":142,"cycle_id":30,"kind":"espera_carregamento","start_ms":1765614931000,"end_ms":1765615085000,"duration_sec":155,"lat":-11.698941,"lon":-47.157193,"cluster_key":"-11.699,-47.157"},{"idx":143,"cycle_id":null,"kind":"espera_basculamento","start_ms":1765615648000,"end_ms":1765615691000,"duration_sec":44,"lat":-11.692847,"lon":-47.165942,"cluster_key":"-11.693,-47.166"},{"idx":144,"cycle_id":31,"kind":"carregamento","start_ms":1765616034000,"end_ms":1765616196000,"duration_sec":163,"lat":-11.69887,"lon":-47.157215,"cluster_key":"-11.699,-47.157"},{"idx":145,"cycle_id":31,"kind":"espera_basculamento","start_ms":1765616756000,"end_ms":1765616799000,"duration_sec":44,"lat":-11.692897,"lon":-47.165532,"cluster_key":"-11.693,-47.166"},{"idx":146,"cycle_id":31,"kind":"basculamento","start_ms":1765616807000,"end_ms":1765616819000,"duration_sec":13,"lat":-11.692951,"lon":-47.165591,"cluster_key":"-11.693,-47.166"},{"idx":147,"cycle_id":32,"kind":"carregamento","start_ms":1765617129000,"end_ms":1765617269000,"duration_sec":141,"lat":-11.698856,"lon":-47.157199,"cluster_key":"-11.699,-47.157"},{"idx":148,"cycle_id":32,"kind":"basculamento","start_ms":1765617873000,"end_ms":1765617908000,"duration_sec":36,"lat":-11.694402,"lon":-47.165185,"cluster_key":"-11.694,-47.165"},{"idx":149,"cycle_id":32,"kind":"basculamento","start_ms":1765617921000,"end_ms":1765617933000,"duration_sec":13,"lat":-11.694305,"lon":-47.165188,"cluster_key":"-11.694,-47.165"},{"idx":150,"cycle_id":33,"kind":"espera_carregamento","start_ms":1765618284000,"end_ms":1765618301000,"duration_sec":18,"lat":-11.699004,"lon":-47.157209,"cluster_key":"-11.699,-47.157"},{"idx":151,"cycle_id":33,"kind":"carregamento","start_ms":1765618317000,"end_ms":1765618557000,"duration_sec":241,"lat":-11.698893,"lon":-47.157225,"cluster_key":"-11.699,-47.157"},{"idx":152,"cycle_id":null,"kind":"espera_basculamento","start_ms":1765619174000,"end_ms":1765619210000,"duration_sec":37,"lat":-11.694379,"lon":-47.165227,"cluster_key":"-11.694,-47.165"},{"idx":153,"cycle_id":null,"kind":"espera_basculamento","start_ms":1765619226000,"end_ms":1765619653000,"duration_sec":428,"lat":-11.694282,"lon":-47.165247,"cluster_key":"-11.694,-47.165"},{"idx":154,"cycle_id":null,"kind":"carregamento","start_ms":1765621495000,"end_ms":1765621626000,"duration_sec":132,"lat":-11.698886,"lon":-47.157097,"cluster_key":"-11.699,-47.157"},{"idx":155,"cycle_id":null,"kind":"espera_basculamento","start_ms":1765622281000,"end_ms":1765622316000,"duration_sec":36,"lat":-11.692766,"lon":-47.164758,"cluster_key":"-11.693,-47.165"},{"idx":156,"cycle_id":null,"kind":"carregamento","start_ms":1765622711000,"end_ms":1765622921000,"duration_sec":211,"lat":-11.698858,"lon":-47.157194,"cluster_key":"-11.699,-47.157"},{"idx":157,"cycle_id":null,"kind":"espera_basculamento","start_ms":1765623555000,"end_ms":1765623589000,"duration_sec":35,"lat":-11.692845,"lon":-47.164776,"cluster_key":"-11.693,-47.165"},{"idx":158,"cycle_id":null,"kind":"espera_basculamento","start_ms":1765623606000,"end_ms":1765623637000,"duration_sec":32,"lat":-11.692918,"lon":-47.164807,"cluster_key":"-11.693,-47.165"},{"idx":159,"cycle_id":null,"kind":"espera_carregamento","start_ms":1765623989000,"end_ms":1765624024000,"duration_sec":36,"lat":-11.699291,"lon":-47.157272,"cluster_key":"-11.699,-47.157"},{"idx":160,"cycle_id":null,"kind":"espera_carregamento","start_ms":1765624110000,"end_ms":1765625075000,"duration_sec":966,"lat":-11.699157,"lon":-47.157217,"cluster_key":"-11.699,-47.157"},{"idx":161,"cycle_id":34,"kind":"carregamento","start_ms":1765625090000,"end_ms":1765625248000,"duration_sec":159,"lat":-11.698923,"lon":-47.157099,"cluster_key":"-11.699,-47.157"},{"idx":162,"cycle_id":34,"kind":"basculamento","start_ms":1765625934000,"end_ms":1765625986000,"duration_sec":53,"lat":-11.693458,"lon":-47.164057,"cluster_key":"-11.693,-47.164"},{"idx":163,"cycle_id":null,"kind":"espera_carregamento","start_ms":1765626408000,"end_ms":1765626568000,"duration_sec":161,"lat":-11.69896,"lon":-47.157143,"cluster_key":"-11.699,-47.157"},{"idx":164,"cycle_id":null,"kind":"espera_carregamento","start_ms":1765626581000,"end_ms":1765626809000,"duration_sec":229,"lat":-11.698891,"lon":-47.157092,"cluster_key":"-11.699,-47.157"},{"idx":165,"cycle_id":34,"kind":"basculamento","start_ms":1765627411000,"end_ms":1765627420000,"duration_sec":10,"lat":-11.694185,"lon":-47.165036,"cluster_key":"-11.694,-47.165"},{"idx":166,"cycle_id":34,"kind":"basculamento","start_ms":1765627430000,"end_ms":1765627495000,"duration_sec":66,"lat":-11.694246,"lon":-47.164952,"cluster_key":"-11.694,-47.165"},{"idx":167,"cycle_id":34,"kind":"espera_basculamento","start_ms":1765627519000,"end_ms":1765627760000,"duration_sec":242,"lat":-11.694224,"lon":-47.165052,"cluster_key":"-11.694,-47.165"},{"idx":168,"cycle_id":null,"kind":"espera_carregamento","start_ms":1765629858000,"end_ms":1765629872000,"duration_sec":16,"lat":-11.6984,"lon":-47.155378,"cluster_key":"-11.698,-47.155"},{"idx":169,"cycle_id":null,"kind":"espera_carregamento","start_ms":1765629882000,"end_ms":1765629908000,"duration_sec":28,"lat":-11.6984,"lon":-47.155379,"cluster_key":"-11.698,-47.155"},{"idx":170,"cycle_id":null,"kind":"espera_carregamento","start_ms":1765629918000,"end_ms":1765629933000,"duration_sec":17,"lat":-11.698401,"lon":-47.155379,"cluster_key":"-11.698,-47.155"},{"idx":171,"cycle_id":null,"kind":"espera_carregamento","start_ms":1765629936000,"end_ms":1765629963000,"duration_sec":29,"lat":-11.698401,"lon":-47.155379,"cluster_key":"-11.698,-47.155"},{"idx":172,"cycle_id":null,"kind":"espera_carregamento","start_ms":1765630001000,"end_ms":1765630024000,"duration_sec":25,"lat":-11.698401,"lon":-47.155378,"cluster_key":"-11.698,-47.155"},{"idx":173,"cycle_id":null,"kind":"espera_carregamento","start_ms":1765630034000,"end_ms":1765630066000,"duration_sec":34,"lat":-11.698401,"lon":-47.155378,"cluster_key":"-11.698,-47.155"},{"idx":174,"cycle_id":null,"kind":"espera_carregamento","start_ms":1765630083000,"end_ms":1765630133000,"duration_sec":52,"lat":-11.698401,"lon":-47.155378,"cluster_key":"-11.698,-47.155"},{"idx":175,"cycle_id":null,"kind":"espera_carregamento","start_ms":1765630259000,"end_ms":1765630292000,"duration_sec":34,"lat":-11.698188,"lon":-47.155008,"cluster_key":"-11.698,-47.155"},{"idx":176,"cycle_id":null,"kind":"espera_carregamento","start_ms":1765630343000,"end_ms":1765630381000,"duration_sec":39,"lat":-11.698832,"lon":-47.155275,"cluster_key":"-11.699,-47.155"},{"idx":177,"cycle_id":null,"kind":"espera_basculamento","start_ms":1765631518000,"end_ms":1765631596000,"duration_sec":79,"lat":-11.694012,"lon":-47.164166,"cluster_key":"-11.694,-47.164"},{"idx":178,"cycle_id":null,"kind":"espera_basculamento","start_ms":1765631599000,"end_ms":1765631615000,"duration_sec":17,"lat":-11.693997,"lon":-47.164171,"cluster_key":"-11.694,-47.164"},{"idx":179,"cycle_id":null,"kind":"espera_basculamento","start_ms":1765631619000,"end_ms":1765631728000,"duration_sec":110,"lat":-11.694007,"lon":-47.16419,"cluster_key":"-11.694,-47.164"},{"idx":180,"cycle_id":null,"kind":"espera_carregamento","start_ms":1765634619000,"end_ms":1765634644000,"duration_sec":26,"lat":-11.700213,"lon":-47.155386,"cluster_key":"-11.700,-47.155"},{"idx":181,"cycle_id":35,"kind":"espera_carregamento","start_ms":1765635012000,"end_ms":1765635029000,"duration_sec":18,"lat":-11.698158,"lon":-47.155254,"cluster_key":"-11.698,-47.155"},{"idx":182,"cycle_id":35,"kind":"espera_carregamento","start_ms":1765635087000,"end_ms":1765635109000,"duration_sec":24,"lat":-11.698392,"lon":-47.15544,"cluster_key":"-11.698,-47.155"},{"idx":183,"cycle_id":35,"kind":"espera_carregamento","start_ms":1765635112000,"end_ms":1765635484000,"duration_sec":374,"lat":-11.698387,"lon":-47.15544,"cluster_key":"-11.698,-47.155"},{"idx":184,"cycle_id":35,"kind":"carregamento","start_ms":1765635154000,"end_ms":1765635483000,"duration_sec":330,"lat":-11.698387,"lon":-47.15544,"cluster_key":"-11.698,-47.155"},{"idx":185,"cycle_id":null,"kind":"espera_carregamento","start_ms":1765635487000,"end_ms":1765635500000,"duration_sec":15,"lat":-11.698379,"lon":-47.15544,"cluster_key":"-11.698,-47.155"},{"idx":186,"cycle_id":null,"kind":"espera_carregamento","start_ms":1765635503000,"end_ms":1765635521000,"duration_sec":20,"lat":-11.698376,"lon":-47.155439,"cluster_key":"-11.698,-47.155"},{"idx":187,"cycle_id":null,"kind":"espera_carregamento","start_ms":1765635593000,"end_ms":1765635609000,"duration_sec":17,"lat":-11.698248,"lon":-47.155011,"cluster_key":"-11.698,-47.155"},{"idx":188,"cycle_id":null,"kind":"espera_carregamento","start_ms":1765635673000,"end_ms":1765635705000,"duration_sec":33,"lat":-11.698973,"lon":-47.155375,"cluster_key":"-11.699,-47.155"},{"idx":189,"cycle_id":null,"kind":"espera_carregamento","start_ms":1765635753000,"end_ms":1765635801000,"duration_sec":50,"lat":-11.699192,"lon":-47.155276,"cluster_key":"-11.699,-47.155"},{"idx":190,"cycle_id":35,"kind":"basculamento","start_ms":1765636847000,"end_ms":1765636866000,"duration_sec":20,"lat":-11.694154,"lon":-47.16434,"cluster_key":"-11.694,-47.164"},{"idx":191,"cycle_id":35,"kind":"espera_basculamento","start_ms":1765636870000,"end_ms":1765637029000,"duration_sec":160,"lat":-11.694126,"lon":-47.16435,"cluster_key":"-11.694,-47.164"},{"idx":192,"cycle_id":35,"kind":"espera_basculamento","start_ms":1765637039000,"end_ms":1765637253000,"duration_sec":215,"lat":-11.69411,"lon":-47.164357,"cluster_key":"-11.694,-47.164"},{"idx":193,"cycle_id":null,"kind":"espera_basculamento","start_ms":1765637262000,"end_ms":1765637288000,"duration_sec":27,"lat":-11.69412,"lon":-47.164363,"cluster_key":"-11.694,-47.164"}];

      const WAIT_KINDS = new Set(["espera_carregamento", "espera_basculamento"]);

      const PATTERN_BY_KIND = {
        carregamento: { id: "pat-load", stroke: "#D00000", bg: "#FF0000" },
        basculamento: { id: "pat-dump", stroke: "#006E1A", bg: "#00FF00" },
        aguardando: { id: "pat-wait", stroke: "#B38F00", bg: "#FFD400" },
      };

      const svg = document.getElementById("svg");
      const scroll = document.getElementById("scroll");
      const tooltip = document.getElementById("tooltip");
      const visibleRange = document.getElementById("visibleRange");
      const windowHoursEl = document.getElementById("windowHours");
      const backBtn = document.getElementById("backBtn");
      const fwdBtn = document.getElementById("fwdBtn");
      const gotoCycleEl = document.getElementById("gotoCycle");
      const gotoCycleBtn = document.getElementById("gotoCycleBtn");
      const toggleWaitEl = document.getElementById("toggleWait");

      function msToHhmm(ms) {
        const d = new Date(ms);
        const hh = String(d.getHours()).padStart(2, "0");
        const mm = String(d.getMinutes()).padStart(2, "0");
        return `${hh}:${mm}`;
      }

      function msToPtBr(ms) {
        const d = new Date(ms);
        const fmt = new Intl.DateTimeFormat("pt-BR", {
          year: "numeric",
          month: "2-digit",
          day: "2-digit",
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit",
        });
        return fmt.format(d);
      }

      function niceTickStepMs(pxPerMs) {
        // Choose a step so ticks are ~80-140px apart.
        const targetPx = 110;
        const raw = targetPx / pxPerMs; // ms
        const steps = [
          60_000, 2*60_000, 5*60_000, 10*60_000, 15*60_000, 30*60_000,
          60*60_000, 2*60*60_000, 4*60*60_000,
        ];
        for (const s of steps) {
          if (s >= raw) return s;
        }
        return steps[steps.length - 1];
      }

      function clearSvg() {
        while (svg.firstChild) svg.removeChild(svg.firstChild);
      }

      function createSvgEl(name) {
        return document.createElementNS("http://www.w3.org/2000/svg", name);
      }

      function addPatterns(defs) {
        const makePat = (id, bg, bgOpacity, stroke, strokeOpacity, mode) => {
          const pat = createSvgEl("pattern");
          pat.setAttribute("id", id);
          pat.setAttribute("patternUnits", "userSpaceOnUse");
          pat.setAttribute("width", "12");
          pat.setAttribute("height", "12");
          const rect = createSvgEl("rect");
          rect.setAttribute("width", "12");
          rect.setAttribute("height", "12");
          rect.setAttribute("fill", bg);
          rect.setAttribute("fill-opacity", String(bgOpacity));
          pat.appendChild(rect);

          const path = createSvgEl("path");
          if (mode === "diag45") {
            path.setAttribute("d", "M-3,9 L9,-3 M0,12 L12,0 M3,15 L15,3");
          } else if (mode === "diag-45") {
            path.setAttribute("d", "M-3,3 L3,-3 M0,12 L12,0 M9,15 L15,9 M-3,15 L15,-3");
          } else if (mode === "horiz") {
            path.setAttribute("d", "M0,2 L12,2 M0,6 L12,6 M0,10 L12,10");
          } else if (mode === "vert") {
            path.setAttribute("d", "M2,0 L2,12 M6,0 L6,12 M10,0 L10,12");
          } else {
            path.setAttribute("d", "M0,0 L12,12");
          }
          path.setAttribute("stroke", stroke);
          path.setAttribute("stroke-width", "2");
          path.setAttribute("stroke-opacity", String(strokeOpacity));
          pat.appendChild(path);
          defs.appendChild(pat);
        };

        makePat("pat-load", "#FF0000", 0.10, "#D00000", 0.55, "diag45");
        makePat("pat-dump", "#00FF00", 0.08, "#006E1A", 0.55, "diag-45");
        makePat("pat-wait", "#FFD400", 0.14, "#B38F00", 0.55, "horiz");
      }

      function displayKind(rawKind) {
        return WAIT_KINDS.has(rawKind) ? "aguardando" : rawKind;
      }

      function render() {
        if (!EVENTS.length) return;

        const showWait = toggleWaitEl.checked;
        const visibleKinds = new Set(["carregamento", "basculamento", "espera_carregamento", "espera_basculamento"]);
        if (!showWait) {
          visibleKinds.delete("espera_carregamento");
          visibleKinds.delete("espera_basculamento");
        }

        // Mantém o eixo de tempo fixo (mesmo se esconder esperas).
        const minStart = Math.min(...EVENTS.map(e => e.start_ms));
        const maxEnd = Math.max(...EVENTS.map(e => e.end_ms));

        const filtered = EVENTS.filter(e => visibleKinds.has(e.kind));

        const viewHours = parseFloat(windowHoursEl.value || "1");
        const viewMs = viewHours * 3600 * 1000;

        const viewWidth = Math.max(1, scroll.clientWidth - 2);
        const pxPerMs = viewWidth / viewMs;
        const totalWidth = Math.ceil((maxEnd - minStart) * pxPerMs) + 1;

        const axisH = parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--axis-height"));
        const laneH = parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--lane-height"));
        const laneGap = parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--lane-gap"));

        const height = Math.ceil(axisH + 2 * laneH + laneGap + 18);

        const currentScrollRatio = (scroll.scrollLeft || 0) / Math.max(1, (svg.viewBox?.baseVal?.width || totalWidth));

        clearSvg();
        svg.setAttribute("width", String(totalWidth));
        svg.setAttribute("height", String(height));
        svg.setAttribute("viewBox", `0 0 ${totalWidth} ${height}`);

        const defs = createSvgEl("defs");
        addPatterns(defs);
        svg.appendChild(defs);

        // Background
        const bg = createSvgEl("rect");
        bg.setAttribute("x", "0");
        bg.setAttribute("y", "0");
        bg.setAttribute("width", String(totalWidth));
        bg.setAttribute("height", String(height));
        bg.setAttribute("fill", "#FFFFFF");
        svg.appendChild(bg);

        // Grid + axis
        const tickStep = niceTickStepMs(pxPerMs);
        const firstTick = Math.floor(minStart / tickStep) * tickStep;

        for (let t = firstTick; t <= maxEnd; t += tickStep) {
          const x = (t - minStart) * pxPerMs;
          const line = createSvgEl("line");
          line.setAttribute("x1", String(x));
          line.setAttribute("x2", String(x));
          line.setAttribute("y1", "0");
          line.setAttribute("y2", String(height));
          line.setAttribute("stroke", "#EDEDED");
          line.setAttribute("stroke-width", "1");
          svg.appendChild(line);

          const txt = createSvgEl("text");
          txt.textContent = msToHhmm(t);
          txt.setAttribute("x", String(x + 4));
          txt.setAttribute("y", String(22));
          txt.setAttribute("font-size", "12");
          txt.setAttribute("fill", "#333");
          txt.setAttribute("font-family", "inherit");
          svg.appendChild(txt);
        }

        // Bands: operações (carregamento/basculamento) + aguardando
        const bandOps = createSvgEl("rect");
        bandOps.setAttribute("x", "0");
        bandOps.setAttribute("y", String(axisH));
        bandOps.setAttribute("width", String(totalWidth));
        bandOps.setAttribute("height", String(laneH + 12));
        bandOps.setAttribute("fill", "#FBFCFD");
        svg.appendChild(bandOps);

        const bandWait = createSvgEl("rect");
        bandWait.setAttribute("x", "0");
        bandWait.setAttribute("y", String(axisH + laneH + laneGap));
        bandWait.setAttribute("width", String(totalWidth));
        bandWait.setAttribute("height", String(laneH + 12));
        bandWait.setAttribute("fill", "#FFFFFF");
        svg.appendChild(bandWait);

        // Events
        for (const e of filtered) {
          const dk = displayKind(e.kind);
          const lane = dk === "aguardando" ? 1 : 0;
          const x = Math.max(0, (e.start_ms - minStart) * pxPerMs);
          const w = Math.max(1, (e.end_ms - e.start_ms) * pxPerMs);
          const y = axisH + 6 + lane * (laneH + laneGap);
          const h = laneH;

          const rect = createSvgEl("rect");
          rect.setAttribute("x", String(x));
          rect.setAttribute("y", String(y));
          rect.setAttribute("width", String(w));
          rect.setAttribute("height", String(h));
          rect.setAttribute("rx", "6");
          rect.setAttribute("ry", "6");
          rect.setAttribute("fill", `url(#${PATTERN_BY_KIND[dk].id})`);
          rect.setAttribute("stroke", PATTERN_BY_KIND[dk].stroke);
          rect.setAttribute("stroke-opacity", "0.55");
          rect.setAttribute("stroke-width", "1");
          rect.style.cursor = "default";

          const kindLabel = dk;

          // Native tooltip (fallback).
          const title = createSvgEl("title");
          title.textContent = `${kindLabel} • ciclo: ${e.cycle_id ?? "-"} • ${e.duration_sec}s`;
          rect.appendChild(title);

          rect.addEventListener("mousemove", (ev) => {
            tooltip.style.display = "block";
            tooltip.style.left = `${ev.clientX + 12}px`;
            tooltip.style.top = `${ev.clientY + 12}px`;
            tooltip.innerHTML = `
              <div><span class="k">evento:</span> <b>${kindLabel}</b></div>
              <div><span class="k">ciclo:</span> <b>${e.cycle_id ?? "-"}</b></div>
              <div><span class="k">início:</span> ${msToPtBr(e.start_ms)}</div>
              <div><span class="k">fim:</span> ${msToPtBr(e.end_ms)}</div>
              <div><span class="k">duração:</span> ${e.duration_sec}s</div>
              <div><span class="k">lat/lon:</span> ${e.lat.toFixed(6)}, ${e.lon.toFixed(6)}</div>
              <div><span class="k">cluster:</span> ${e.cluster_key}</div>
            `;
          });
          rect.addEventListener("mouseleave", () => {
            tooltip.style.display = "none";
          });

          svg.appendChild(rect);
        }

        // Keep scroll roughly where it was
        const desiredLeft = Math.floor(currentScrollRatio * totalWidth);
        scroll.scrollLeft = Math.max(0, Math.min(totalWidth - viewWidth, desiredLeft));

        function updateVisibleRange() {
          const leftMs = minStart + (scroll.scrollLeft / pxPerMs);
          const rightMs = leftMs + viewMs;
          visibleRange.textContent = `visível: ${msToPtBr(leftMs)} → ${msToPtBr(rightMs)}`;
        }
        scroll.onscroll = updateVisibleRange;
        updateVisibleRange();

        backBtn.onclick = () => {
          scroll.scrollLeft = Math.max(0, scroll.scrollLeft - viewWidth);
        };
        fwdBtn.onclick = () => {
          scroll.scrollLeft = Math.min(totalWidth, scroll.scrollLeft + viewWidth);
        };

        gotoCycleBtn.onclick = () => {
          const cid = parseInt(gotoCycleEl.value || "", 10);
          if (!Number.isFinite(cid)) return;
          const first = filtered.find(ev => ev.cycle_id === cid);
          if (!first) return;
          const x = (first.start_ms - minStart) * pxPerMs;
          scroll.scrollLeft = Math.max(0, x - 30);
        };
      }

      let resizeTimer = null;
      window.addEventListener("resize", () => {
        if (resizeTimer) clearTimeout(resizeTimer);
        resizeTimer = setTimeout(() => render(), 120);
      });
      windowHoursEl.addEventListener("change", () => render());
      toggleWaitEl.addEventListener("change", () => render());

      render();
    </script>
  </body>
</html>
